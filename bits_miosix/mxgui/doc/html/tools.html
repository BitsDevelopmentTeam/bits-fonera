<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>mxgui: Mxgui tools</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Mxgui tools </h1>  </div>
</div>
<div class="contents">
<p>The mxgui tools is a set of utilities to help in developing embedded user interfaces. They are released under the GPL, with no linking exception as opposed to the mxgui library since they are standalone applications and not libraries.</p>
<h2><a class="anchor" id="req"></a>
Requirements</h2>
<p>The mxgui tools are designed to be run from a Linux desktop, Windows is not currently supported as the bash shell is sometimes required. They depend on CMake for the build system, and the boost libraries. The mxgui simulator also requires the Qt libraries (development version) as they are used to open a window on screen.</p>
<h2><a class="anchor" id="codegen"></a>
Code generators</h2>
<p>The code generators are a set of three command line applications, namely pngconverter, fontrendering and resourcefs which are used to generate source code or binary files. They can be found in the mxgui/tools/code_generators directory.</p>
<p>To build them, open a shell in the mxgui/tools/code_generators/build directory and type </p>
<div class="fragment"><pre class="fragment">cmake ..
make
</pre></div><p> As a result you will find the binaries in the same directory.</p>
<h3><a class="anchor" id="pngconv"></a>
pngconverter</h3>
<p>Pngconverter is likely to be the most used tool, its purpose is to convert a png image in a set of a .cpp and a .h file with a static instance of the Image class, usable to draw an image on screen.</p>
<p>When run with the --help parameter it prints this: </p>
<div class="fragment"><pre class="fragment">./pngconverter --help
PngConverter utility v1.21
Designed by TFT : Terraneo Federico Technologies
Options:
  --help                Prints this.
  --in arg              Input png file (required)
  --depth arg           <a class="code" href="group__pub__iface.html#ga4fed5b67f867c0a3b3fef60f01d6b364">Color</a> depth, 1,8,16,18 or 24 bits (required)
  --out arg             Output png file <span class="keywordflow">for</span> validation
  --binary              Generate a binary file instead of a .cpp/.h file
</pre></div><p>To use it, assume you have an image called test.png that needs to be embedded into a firmware at a 16 bit per pixel color depth, the command line to do so is </p>
<div class="fragment"><pre class="fragment">./pngconverter --in test.png --depth 16
</pre></div><p> As a result, the program will produce, in the same directory where the test.png file is, two files: test.cpp and test.h In particular, the file test.h will contain the following line of code: </p>
<div class="fragment"><pre class="fragment"><span class="keyword">extern</span> <span class="keyword">const</span> <a class="code" href="classmxgui_1_1basic__image.html">mxgui::Image</a> test;
</pre></div><p> This is the instance of the Image class that can be used to draw the image.</p>
<p>To actually draw the image on screen, it is required to perform the following steps: first, the file test.cpp should be added to the makefile (if compiling for Miosix), or the qtsimulator's CMakeLists.txt (if using the simulator), then, a simple main program that prints the image is this: </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &quot;<a class="code" href="entry_8h.html">mxgui/entry.h</a>&quot;</span>
<span class="preprocessor">#include &quot;mxgui/display.h&quot;</span>
<span class="preprocessor">#include &quot;test.h&quot;</span> <span class="comment">//Header file of the image to draw</span>

<span class="keyword">using namespace </span>mxgui;

<a class="code" href="group__pub__iface.html#ga7542714e8c7019113b62db816c78d50c">ENTRY</a>()
{
    {
        DrawingContext dc(<a class="code" href="classmxgui_1_1_display.html#a1467142a95619a6e3380a59ab8704069">Display::instance</a>());
        dc.drawImage(Point(0,0),test);
    }
    <span class="keywordflow">for</span>(;;) ;
}
</pre></div><p> It should be noted that the name of the Image class instance is the same as the png file name. Therefore the png file name should be a valid C++ variable identifier, thetis, it should not contain spaces or begin with a number.</p>
<h3><a class="anchor" id="fontr"></a>
fontrendering</h3>
<p>This tool is used to convert a TTF or BDF font file into a set of lookup tables, contained in an header file, usable to print text using that font.</p>
<p>You will not likely use this tool directly, as mxgui has a set of predefined fonts available by including <a class="el" href="misc__inst_8h.html">mxgui/misc_inst.h</a>. Note that, for code size reasons, you may need to enable support for those fonts in <a class="el" href="mxgui__settings_8h.html">mxgui_settings.h</a>. For example, bold fonts are disabled by default, if you need them uncomment MXGUI_ENABLE_BOLD_FONTS in <a class="el" href="mxgui__settings_8h.html">mxgui_settings.h</a></p>
<p>However, if you have a specific font you want to use, you can convert it using fontrendering.</p>
<p>Have a look at the mxgui/tools/code_generators/convert.sh script to see how to use fontrendering, or type </p>
<div class="fragment"><pre class="fragment">./fontrendering --help
</pre></div><h3><a class="anchor" id="resfs"></a>
resourcefs</h3>
<p>resourcefs is a tool designed to address the need to store large amounts of images even on microcontroller with little flash memory, for which the pngconverter+embedding approach isn't suitable.</p>
<p>The idea is simple, preprocess the images as usual using pngconverter, but this time generate binary files instead of source files, group those files in a readonly filesystem and store it inside an external flash memory, most likely one with an SPI interface.</p>
<p>To use resourcefs, consider you have a directory named images_in full of png images, and you want to make a filesystem with it. This script will do this: </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#!/bin/bash</span>
<span class="preprocessor"></span>
export PATH=$PATH:&lt;path where pngconverter and resourcefs are located&gt;

rm -rf resource
cp -R images_in resource
cd resource
<span class="keywordflow">for</span> i in `ls`; <span class="keywordflow">do</span>
    pngconverter --in=$i --depth 16 --binary
done
rm *.png
cd ..
resourcefs --in resource --out resource.fs
</pre></div><p> Keep in mind that resourcefs currently does not support subdirectories.</p>
<p>Then you need to flash the genearted resource.fs onto the flash memory on your device, and write the code to allow mxgui to read from it. An example of how to do so is available in mxgui/drivers/resfs_mp3v2.h and mxgui/drivers/resfs_mp3v2.cpp. Basically, you need to implement two functions, backendInit() and backendRead().</p>
<p>At this point you can draw an image by using the ResourceImage class. Assuming that the filesystem contains an image named test, the code to draw it is this:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &quot;<a class="code" href="entry_8h.html">mxgui/entry.h</a>&quot;</span>
<span class="preprocessor">#include &quot;mxgui/display.h&quot;</span>
<span class="preprocessor">#include &quot;mxgui/resource_image.h&quot;</span>

<span class="keyword">using namespace </span>mxgui;

<a class="code" href="group__pub__iface.html#ga7542714e8c7019113b62db816c78d50c">ENTRY</a>()
{
    {
        DrawingContext dc(<a class="code" href="classmxgui_1_1_display.html#a1467142a95619a6e3380a59ab8704069">Display::instance</a>());
        ResourceImage image(<span class="stringliteral">&quot;test&quot;</span>);
        dc.drawImage(Point(0,0),image);
    }
    <span class="keywordflow">for</span>(;;) ;
</pre></div><p>Note that when using the mxgui simulator the ResourceImage class works by searching images inside a "resource" directory that must be present in the same directory where the qtsimulator binary is.</p>
<h2><a class="anchor" id="sim"></a>
Mxgui simulator</h2>
<p>The Mxgui simulator, also called qtsimulator is a Qt gui application that open a window of the size of the embedded display, and allows to debug the visual aspect of an mxgui application without using the embedded device. It is pixel perfect in the sense that Qt is only used to provide a window, all the font, image and line drawing algorithms used for the simulator are the same as the ones that will be used when the code in run in the embedded system.</p>
<p>On the other hand, qtsimulator does only map mxgui calls into a virtual framebuffer in Qt, it does not simulate the whole Miosix kernel, nor it is a binary virtual machine that executes ARM code on x86 CPUs. This means that it does not simulate the cpu and memory limitations of the embedded system, nor its peripherals. This means that it cannot be used to profile the embedded code as when run on the embedded system it will run slower due to the lower power processor, and also it does not help in debugging memory issues. For instance, allocating an 1MB data structure will succeed in the simulator, but will fail on the embedded system (unless it has more than 1MB of RAM...)</p>
<p>The simulator is in the mxgui/tools/qtsimulator. To compile it, as usual, open a shell in the mxgui/tools/qtsimulator/build folder and type </p>
<div class="fragment"><pre class="fragment">cmake ..
make
</pre></div><p> But before you might want to edit the FOO_SRCS in the CMakeLists.txt file to add your sorce files. In fact, the simulator and the Miosix kernel use two different build systems, CMake for the simulator and plain makefiles for Miosix. This means that if you add a source file to your project, you need to remember to add it to both the Makefile in the top level directory (for Miosix) and to the CMakeLists.txt on mxgui/tools/qtsimulator (for the simulator).</p>
<p>The simulator compiles into a binary in the build folder. You can launch it by simply double-clicking the file. </p>
<div align="center">
<img src="simulator.png" alt="simulator.png"/>
<p><strong>The Mxgui simulator, running one of the demos</strong></p></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sun Sep 18 2011 for mxgui by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
